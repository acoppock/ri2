<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing ri and ri2 • ri2</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">ri2</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ri2_vignette.html">Randomization Inference with ri2</a>
    </li>
    <li>
      <a href="../articles/ri2_vs_ri.html">Comparing ri and ri2</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Comparing ri and ri2</h1>
                        <h4 class="author">Alexander Coppock, Yale University</h4>
            
            <h4 class="date">2018-01-25</h4>
          </div>

    
    
<div class="contents">
<p>The <code>ri2</code> package is the successor package to <code>ri</code>. The two packages use entirely different syntax. This guide shows how the same tasks would be accomplished in each.</p>
<div id="basic-example" class="section level1">
<h1 class="hasAnchor">
<a href="#basic-example" class="anchor"></a>Basic example</h1>
<p>Consider a two-arm trial in which exactly 3 of 10 units are assigned to treatment and the remainder is assigned to control. We want to conduct a hypothesis test under the sharp null hypothesis of no effect for any unit.</p>
<p>Here are the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)
Z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(Y, Z)</code></pre></div>
<p>In <code>ri</code>, you use the observed treatment assignment (<code>Z</code>) to tell the computer the experimental design in <code>genprobexact</code> and <code>genperms</code>. <code>estate</code> calculates the observed ATE estimate, <code>genouts</code> builds hypothetical potential outcomes under the sharp null hypothesis, and <code>gendist</code> cycles through all the permutations to calculate the sampling distribution of the estimator under the null.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ri)

probs &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/genprobexact">genprobexact</a></span>(Z)
perms &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/genperms">genperms</a></span>(Z)
ate &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/estate">estate</a></span>(Y, Z, <span class="dt">prob =</span> probs)

Ys &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/genouts">genouts</a></span>(Y, Z)
distout &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/gendist">gendist</a></span>(Ys, perms, <span class="dt">prob =</span> probs)
ri_out &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/dispdist">dispdist</a></span>(distout, ate, <span class="dt">display.plot =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>In <code>ri2</code>, you explictly describe the random assignment procedure with the <code>declare_ra</code> function. The <code>conduct_ri</code> then combines a test statistic function, the data, and the declaration to calculate the sampling distribution under the null (which by default is the sharp null hypothesis of no effect).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ri2)</code></pre></div>
<pre><code>## Loading required package: randomizr</code></pre>
<pre><code>## Loading required package: estimatr</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">declaration &lt;-<span class="st"> </span><span class="kw">declare_ra</span>(<span class="dt">N =</span> <span class="dv">10</span>, <span class="dt">m =</span> <span class="dv">3</span>)
ri2_out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/conduct_ri.html">conduct_ri</a></span>(Y <span class="op">~</span><span class="st"> </span>Z, 
                      <span class="dt">data =</span> dat, 
                      <span class="dt">declaration =</span> declaration)</code></pre></div>
<p>The two programs obtain the same answers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ri_out<span class="op">$</span>two.tailed.p.value.abs</code></pre></div>
<pre><code>## [1] 0.1666667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(ri2_out)<span class="op">$</span>two_tailed_p_value</code></pre></div>
<pre><code>## [1] 0.1666667</code></pre>
</div>
<div id="complex-example" class="section level1">
<h1 class="hasAnchor">
<a href="#complex-example" class="anchor"></a>Complex example</h1>
<p>More complex two-arm designs sometimes incorporate cluster and block information into the random assignment procedure. The <code>ri</code> helpfile uses this example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>)
Z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)
cluster &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">9</span>)
block &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>), <span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="kw">rep</span>(<span class="dv">3</span>, <span class="dv">8</span>))

dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(y, Z, cluster, block)</code></pre></div>
<p>In <code>ri</code>, you supply cluster and block information to <code>genperms</code> and <code>genprobexact</code>, and the rest of the code stays the same as the basic example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">perms &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/genperms">genperms</a></span>(Z, <span class="dt">blockvar =</span> block, <span class="dt">clustvar =</span> cluster)
probs &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/genprobexact">genprobexact</a></span>(Z, <span class="dt">blockvar =</span> block, <span class="dt">clustvar =</span> cluster)
ate &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/estate">estate</a></span>(y, Z, <span class="dt">prob =</span> probs)
  
Ys &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/genouts">genouts</a></span>(y, Z, <span class="dt">ate =</span> <span class="dv">0</span>)
distout &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/gendist">gendist</a></span>(Ys, perms, <span class="dt">prob =</span> probs)
ri_out &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/dispdist">dispdist</a></span>(distout, ate, <span class="dt">display.plot =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>The <code>ri</code> package guesses the number of clusters in each block to treatment based on the realized random assignment. In <code>ri2</code>, we need to explicitly declare the number of clusters to treat in each block with <code>block_m</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">block_m &lt;-<span class="st"> </span><span class="kw">tapply</span>(Z, block, sum) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>
declaration &lt;-<span class="st"> </span><span class="kw">declare_ra</span>(<span class="dt">blocks =</span> block, <span class="dt">clusters =</span> cluster, <span class="dt">block_m =</span> block_m)
ri2_out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/conduct_ri.html">conduct_ri</a></span>(y <span class="op">~</span><span class="st"> </span>Z, <span class="dt">declaration =</span> declaration, <span class="dt">data =</span> dat)</code></pre></div>
<p>Again, the two programs obtain the same answers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ri_out<span class="op">$</span>two.tailed.p.value.abs</code></pre></div>
<pre><code>## [1] 0.1944444</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(ri2_out)<span class="op">$</span>two_tailed_p_value</code></pre></div>
<pre><code>## [1] 0.1944444</code></pre>
</div>
<div id="the-need-for-explicit-random-assignment-declaration" class="section level1">
<h1 class="hasAnchor">
<a href="#the-need-for-explicit-random-assignment-declaration" class="anchor"></a>The need for explicit random assignment declaration</h1>
<p>The <code>ri</code> package infers the random assignment procedure from the observed random assignment and the blocking and clustering variables, if applicable. It can do this by assuming complete random assignment. Complete random assignment is a procedure in which exactly <span class="math inline">\(m\)</span> of <span class="math inline">\(N\)</span> units are assigned to treatment. There are clustered and blocked variants of complete random assignment. In a clustered design, exactly <span class="math inline">\(m\)</span> of <span class="math inline">\(N\)</span> <strong>clusters</strong> is assigned to to treatment; in a blocked design, we do complete random assignment block by block.</p>
<p>But complete random assignment is strict. Imagine we have 3 units and we want to assign “half” to treatment.</p>
<ul>
<li>Option 1: assign 1 of 3 to treatment (assignment probability: 1/3)</li>
<li>Option 2: assign 2 of 3 to treatment (assignment probability: 2/3)</li>
<li>Option 3: randomize between options 1 and 2 with probability 0.5 (assignment probability: 1/2)</li>
</ul>
<p>Options 1 and 2 aren’t particularly appealing. But option 3 isn’t actually complete random assignment – it’s a mixture of two complete random assignment designs. In total, there are 6 possible random assignments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">declaration &lt;-<span class="st"> </span><span class="kw">declare_ra</span>(<span class="dv">3</span>)
<span class="kw">obtain_permutation_matrix</span>(declaration)</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    0    0    1    0    1    1
## [2,]    0    1    0    1    0    1
## [3,]    1    0    0    1    1    0</code></pre>
<p>But in <code>ri</code>, we could never sample from all six, because the <strong>realized</strong> assignment would only have 1 or 2 units treated:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/genperms">genperms</a></span>(<span class="dt">Z =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##   [,1] [,2] [,3]
## 1    1    0    0
## 2    0    1    0
## 3    0    0    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ri/topics/genperms">genperms</a></span>(<span class="dt">Z =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##   [,1] [,2] [,3]
## 1    1    1    0
## 2    1    0    1
## 3    0    1    1</code></pre>
<p>The <code>declare_ra</code> function can accomodate all of the random assignment procedures that the <code>ri</code> package can understand and mixtures of those procedures. There are of course random assignment procedures beyond those that can be declared in <code>declare_ra</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#basic-example">Basic example</a></li>
      <li><a href="#complex-example">Complex example</a></li>
      <li><a href="#the-need-for-explicit-random-assignment-declaration">The need for explicit random assignment declaration</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alexander Coppock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
